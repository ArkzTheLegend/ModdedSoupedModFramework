(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{431:function(e,t,a){"use strict";a.r(t);var o=a(62),i=Object(o.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"developing-with-smf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#developing-with-smf"}},[e._v("#")]),e._v(" Developing with SMF")]),e._v(" "),a("h2",{attrs:{id:"about-smf-and-how-it-works"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#about-smf-and-how-it-works"}},[e._v("#")]),e._v(" About SMF and how it works")]),e._v(" "),a("p",[e._v("Part of SMF's goal is to expose an API to create mods for Bloons TD Battles 2 (which I will refer to as 'BTDB2'). Unlike Bloons TD6 (BTD6), BTDB2 is not made with Unity. Since Unity uses C#, modding tools like MelonLoader can be used on BTD6 to create mods. MelonLoader is powerful and gives you a library you can link your own C# code against to create mods. BTDB2, on the other hand, was not created with Unity, but instead a proprietary engine created by Ninja Kiwi. This engine is believed to be a heavily modified version of the BTD5/BTDB1 engines. This engine is written in C++ and not C#, so unfortunately we cannot decompile the game to make mods. (Even if we could decompile the game, it wouldn't produce anything meaningful to mod creators, since function & type names would have been lost in the process) This does not mean making mods is impossible! Looking back on BTD5's modding scene, there is something called a 'jet' file. These 'jet' files hold the contents for the game's assets. In BTDB2, we have 'jet' files inside of the game's files, but no way to edit them. Unlike BTD5, we cannot just extract the jet files with 7zip, (Technically we actually can, but there's no reason to as you'll find out) However, we "),a("em",[e._v("can")]),e._v(" modify their contents inside of the game's memory. This is done in the form of 'patchers', which you will learn all about in this guide.")]),e._v(" "),a("h2",{attrs:{id:"creating-your-first-mod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#creating-your-first-mod"}},[e._v("#")]),e._v(" Creating your first mod")]),e._v(" "),a("p",[e._v("SMF mods are very simple, they are just uncompressed tar/zip files with a 'meta.json' file inside. While developing a mod, you will not be required to package it into the tar/zip archive to test it.")]),e._v(" "),a("h3",{attrs:{id:"getting-started-meta-json"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#getting-started-meta-json"}},[e._v("#")]),e._v(" Getting started (+ meta.json)")]),e._v(" "),a("p",[e._v("To get started, create a new folder inside of the 'mods' folder. (If there is no 'mods' folder, simply create one) You can name this folder anything you want. Inside of the folder, create a new 'meta.json' file. It is important that the meta.json file has the information SMF needs. Take a look at the meta.json example file below:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('{\n    "authors": [\n        "DisabledMallis",\n        "B2C",\n        "NeverGlow"\n    ],\n    "description": "This is an example mod that does very cool things!",\n    "name": "Example Mod",\n    "scripts": [\n        "exampleScript.js"\n    ],\n    "version": "1.0.0"\n}\n')])])]),a("p",[e._v("So, what do these fields mean?")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("authors")]),e._v(" - A list of who created the mod")]),e._v(" "),a("li",[a("code",[e._v("description")]),e._v(" - A description of what the mod does")]),e._v(" "),a("li",[a("code",[e._v("name")]),e._v(" - The name of the mod")]),e._v(" "),a("li",[a("code",[e._v("scripts")]),e._v(" - A list of every script file this mod needs to load")]),e._v(" "),a("li",[a("code",[e._v("version")]),e._v(" - The version of the mod")])]),e._v(" "),a("p",[e._v("It is important that the file includes a "),a("code",[e._v("name")]),e._v(", "),a("code",[e._v("version")]),e._v(" and "),a("code",[e._v("scripts")]),e._v(" field. You shouldn't leave out the other fields, but it wont be very problematic if you do.")]),e._v(" "),a("h3",{attrs:{id:"scripting-part-1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scripting-part-1"}},[e._v("#")]),e._v(" Scripting part 1")]),e._v(" "),a("p",[e._v("Now that we have our meta.json created, lets create a script for our mod. Inside of the meta.json, we specified that the mod has a script called "),a("code",[e._v("exampleScript.js")]),e._v(". So, inside of the mod folder we create a new "),a("code",[e._v("exampleScript.js")]),e._v(" file. Scripts are created using JavaScript (JS), which is fairly easy to learn. Since the JS code is not running in a browser, but inside of the game itself, most browser front-end APIs are missing (such as window.* and document*) but we don't need those to create mods anyway.")]),e._v(" "),a("p",[e._v("Inside of our script, we may want to create something called a 'patcher'. A patcher just modifies the game's assets when theyre loaded. You can register a patcher with the "),a("code",[e._v("souped.registerPatcher")]),e._v(" function. However, there is an easier version of the function called "),a("code",[e._v("souped.registerJsonPatcher")]),e._v(" which makes modifying the game's json a little bit easier.")]),e._v(" "),a("p",[e._v("To register a patcher, simply add this into your mod's JS file:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('souped.registerJsonPatcher(myPatcher, "tack_shooter.tower_blueprint");\n')])])]),a("p",[e._v("Now you may be wondering what "),a("code",[e._v("myPatcher")]),e._v(" is. It's important to create the actual patcher itself "),a("em",[e._v("before")]),e._v(" that line in order for it to be registered. Your code may look like the following:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('function myPatcher(data) {\n    return { successful: false, data: data };\n};\n\nsouped.registerJsonPatcher(myPatcher, "tack_shooter.tower_blueprint");\n')])])]),a("p",[e._v("The next missing piece of this puzzle is the "),a("code",[e._v('"tack_shooter.tower_blueprint"')]),e._v(" string. This parameter of the function is a 'selector' for which files this patcher should patch. If you were to write "),a("code",[e._v('".tower_blueprint"')]),e._v(", that would mean every single file with "),a("code",[e._v('".tower_blueprint"')]),e._v(" in its file name would be patched by this patcher, effectively giving you a way to modify every single tower in the game with a single patcher.")]),e._v(" "),a("p",[e._v('But what is a "tower_blueprint" file?')]),e._v(" "),a("h3",{attrs:{id:"analyzing-the-dump"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#analyzing-the-dump"}},[e._v("#")]),e._v(" Analyzing the dump")]),e._v(" "),a("p",[e._v("When you launch BTDB2 with SMF, it will create a 'dump' folder. Inside of this folder holds all of the assets that your game has loaded while SMF is loaded. The folders inside are named in the format of "),a("code",[e._v("<name>_<hash>.jet")]),e._v(' so they may be confusing to read. Either way, the one with the name "simulation" contains the files for in-match assets. We can find the "tack_shooter.tower_blueprint" file inside of the "game_data/game_project/assets/towers/tack_shooter/data" folder. You can open this file in '),a("a",{attrs:{href:"https://code.visualstudio.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("VS Code"),a("OutboundLink")],1),e._v(". This is the recommended code editor to use for making SMF mods. When you open the file, click the 'Plain Text' button in the bottom right. This will give you the option to change the file type inside of VS Code, change it to \"JSON\". This will allow you to format the document by pressing "),a("code",[e._v("ctrl")]),e._v("+"),a("code",[e._v("shift")]),e._v("+"),a("code",[e._v("p")]),e._v(', and then typing "Format Document". This will make the JSON a lot easier to read.')]),e._v(" "),a("h3",{attrs:{id:"scripting-part-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scripting-part-2"}},[e._v("#")]),e._v(" Scripting part 2")]),e._v(" "),a("p",[e._v("Now that we have a \"tower_blueprint\" file we want to edit, we can modify it in our script. Lets say we want to change the 'range' variable of the JSON")]),e._v(" "),a("p",[e._v("tack_shooter.tower_blueprint example:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('{\n    ...\n    "variables": [\n        {\n            "key": "range",\n            "variable": {\n                "type": "Float",\n                "value": 23.0\n            }\n        },\n        ...\n    ]\n}\n')])])]),a("p",[e._v("Our script:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('function myPatcher(data) {\n    //Get the variables\n    var tackVars = data["variables"];\n    //Loop through the variables to find the \'range\' variable\n    for(var i = 0; i < tackVars.length; i++) {\n        //Get the current variable\n        var currentVar = tackVars[i];\n        //Check if it is the range variable\n        if(currentVar["key"] == "range") {\n            //Get the variable object\n            var rangeVar = currentVar["variable"];\n            //Set its value\n            rangeVar["value"] = 99;\n            //Store the variable back into the current var\n            currentVar["variable"] = rangeVar;\n        }\n        //Store the current var back into tackVars\n        tackVars[i] = currentVar;\n    }\n    //Store tackVars back into the data\n    data["variables"] = tackVars;\n\n    //Return that it was successful, as well as the modified data\n    return { successful: true, data: data };\n};\n\nsouped.registerJsonPatcher(myPatcher, "tack_shooter.tower_blueprint");\n')])])]),a("h3",{attrs:{id:"sharing-your-mod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sharing-your-mod"}},[e._v("#")]),e._v(" Sharing your mod")]),e._v(" "),a("p",[e._v("Now that you have created a mod, you may want to share it with others. You will need "),a("a",{attrs:{href:"https://www.7-zip.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("7-zip"),a("OutboundLink")],1),e._v(" to do this part of the tutorial. The best way to do this is to distribute them as \".smf\" files. To create a .smf file for your mod, select all of the files inside of your mod folder and then right-click -> 7-zip -> Add to archive... Select 'tar' for the \"Archive format\". Rename the file to replace '.tar' with '.smf' (this tells SMF that the file "),a("em",[e._v("is")]),e._v(" a tar file containing a valid 'meta.json' file). You now have a shareable mod file!")])])}),[],!1,null,null,null);t.default=i.exports}}]);